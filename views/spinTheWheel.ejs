<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spin the Wheel!</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat&display=swap');
        body {
            background: #0A0913;
            background-image: url('https://cdn.discordapp.com/attachments/1080157954570993664/1140927778020134932/image.png');
            background-size: cover;
            background-repeat: no-repeat;
            overflow: hidden;
        }

        .container {
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            flex-direction: column;
        }

        .wheelContainer {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #wheel {
            transition: 3s;
            transform-origin: center center;
        }

        .arrowImg {
            transform: translateX(-50%);
            position: absolute;
            left: 50%;
            height: 10vh;
        }
    </style>
</head>
<body>
    <div class="container">
        <%- include('./partials/navbar.ejs') %>
        <div class="wheelContainer">
            <div class="wheel">
                <div style="
                    height: 84vh; 
                    width: 84vh; 
                    background: rgba(0, 0, 0, 0.7); 
                    display: flex; 
                    align-items: center; 
                    justify-content: center;
                    flex-direction: column;
                    color: white;
                    font-size: 1.1em;
                    font-family: 'Montserrat'">
                    <div style="position: relative;">
                        <img id='wheel' src="wheel.png" style="height:60vh;width:auto;cursor:pointer;">
                        <img src="arrow.png" class="arrowImg">
                    </div>
                    <br style="clear: both">
                    <p>Click On The Wheel To Spin!</p>
                </div>
            </div>
        </div>
    </div>
    <script>
        const wheelImg = document.getElementById('wheel');
        wheelImg.addEventListener('click', (e) => {
                const randomRotation = Math.floor(Math.random() * 359);
                const finalRotation = 720 + randomRotation;
                var finalEarnings = null;
                wheelImg.style.transform = 'rotate(' + finalRotation + 'deg)';
                wheelImg.style.transformOrigin = (wheelImg.width/2) + " " + (wheelImg.height/2);
                if (randomRotation <= 90) {
                    finalEarnings = -50;
                } else if (randomRotation <= 180) {
                    finalEarnings = 60;
                } else if (randomRotation <= 270) {
                    finalEarnings = -20;
                } else {
                    finalEarnings = 0;
                }
            setTimeout(function() {
                const xhttp = new XMLHttpRequest();
                xhttp.onload = function() {
                    console.log("Bye")
                }
                xhttp.open("POST", "/spin-the-wheel");
                xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded")
                xhttp.send(`finalEarnings=${finalEarnings}`)
            })
        })
    </script>
</body>
</html>